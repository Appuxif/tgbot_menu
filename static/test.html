<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Instascan</title>
    <script type="text/javascript" src="https://rawcdn.githack.com/tobiasmuehl/instascan/4224451c49a701c04de7d0de5ef356dc1f701a93/bin/instascan.min.js"></script>
  </head>
  <body>
<!--  iso8859_1-->
    <video id="preview"></video>
    <p id="info"></p>
    <button id="switch_camera">SWITCH</button>
    <script type="text/javascript">
      let opts = {
        continuous: true,
        video: document.getElementById('preview'),
        mirror: false,
        captureImage: true,
        backgroundScan: false,
        scanPeriod: 5
      };
      let scanner = new Instascan.Scanner(opts);
      let p_info = document.getElementById('info');
      let btn_switch = document.getElementById('switch_camera');
      let camera_num = 0;
      let cameras_list = [];
      btn_switch.addEventListener('click', (e) => {
          e.preventDefault();
          scanner.stop();
          camera_num = ++camera_num % cameras_list.length;
          scanner.start(cameras_list[camera_num]);
      });

      scanner.addListener('scan', function (content) {
        alert('scanner listener' + content);
        console.log(content);
      });
      Instascan.Camera.getCameras().then(function (cameras) {
          cameras_list = cameras;
          camera_num = cameras.length - 1;
        if (cameras.length > 0) {
            p_info.textContent = '';
            for (let i = 0; i < cameras.length; i++) {
                p_info.textContent += i + ' ' + cameras[i].name + '\n'
            }
          scanner.start(cameras[camera_num]);
        } else {
          console.error('No cameras found.');
        }
      }).catch(function (e) {
        console.error(e);
      });
    </script>
  </body>
</html>